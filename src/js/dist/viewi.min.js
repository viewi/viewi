(()=>{var D=class{count=0;increment(){this.count++}decrement(){this.count--}};var M=class{items=[];addNewItem(t){this.items.push(t)}};var m=class{_props={};$_callbacks={};_refs={};_slots={};_element=null;$$t=[];$$r={};$;_name="BaseComponent";emitEvent(t,n){this.$_callbacks&&t in this.$_callbacks&&this.$_callbacks[t](n)}};var L=class extends m{_name="MenuBar"};function k(e){var t=e+"";return t.length}var P=class extends m{_name="Counter";count=0;message="My message";increment(){this.count++,this.message+="!"}decrement(){this.count--}},Z=[function(e){return function(t){e.decrement()}},function(e){return e.count%10+12},function(e){return`
    Count `+e.count+" "+k(e.message)+`
`},function(e){return`
Count `+e.count+" "+k(e.message)+`
`},function(e){return function(t){e.increment()}},function(e){return function(t){e.increment(t)}},function(e){return e.increment.bind(e)},function(e){return e.message}];var H=class extends m{_name="HomePage";title="Viewi v2 - Build reactive front-end with PHP"},ee=[function(e){return e.title},function(e){return e.title}];var K=class extends m{_name="Layout";title="Viewi"},te=[function(e){return`
        `+e.title+` | Viewi
    `}];var O=class extends m{_name="NotFoundPage"};var R=class extends m{_name="CounterPage"};var F=class extends m{_name="TodoAppPage"};var U=class extends m{_name="StatefulCounter";counter=null;$message="Secret message";count=null;constructor(t){super(),this.count=t===void 0?0:t,this.counter=new D}$calculate(){this.count++}},ne=[function(e){return function(t){e.counter.decrement()}},function(e){return e.__id},function(e){return e.counter.count},function(e){return function(t){e.counter.increment()}}];function S(e,t){let n,i=0;if(e===null||typeof e>"u")return 0;if(e.constructor!==Array&&e.constructor!==Object)return 1;t==="COUNT_RECURSIVE"&&(t=1),t!==1&&(t=0);for(n in e)e.hasOwnProperty(n)&&(i++,t===1&&e[n]&&(e[n].constructor===Array||e[n].constructor===Object)&&(i+=S(e[n],1)));return i}var W=class extends m{_name="StatefulTodoApp";text="";todo=null;constructor(t){super(),this.todo=t}handleSubmit(t){t.preventDefault(),k(this.text)!=0&&(this.todo.addNewItem(this.text),this.text="")}},oe=[function(e){return function(t){e.handleSubmit(t)}},function(e){return e.text},function(e){return`
        Add #`+(S(e.todo.items)+1)+`
    `},function(e){return e.todo.items}];var j=class extends m{_name="TestComponent";name="MyName";_name2_Test="MyName_2";empty="";null=null;url="/home";attr="title";event="(click)";arr=["a","b","c"];arrWithKeys={a:"Apple",b:"Orange",c:"Lemon"};arrNested={a:{a:"Apple",b:"Orange",c:"Lemon"},b:{a:"Apple",b:"Orange",c:"Lemon"},c:{a:"Apple",b:"Orange",c:"Lemon"}};ifValue=!0;ifElseValue=!0;getName(t){var n=60;return t??"DefaultName"}onEvent(t){t.preventDefault()}toggleIf(){this.ifValue=!this.ifValue}toggleElseIf(){this.ifElseValue=!this.ifElseValue}},re=[function(e){return"Tag test "+e.name+" "+e._name2_Test},function(e){return`
    $notAVar `+e.getName()+" "+e.getName(e.name)+`
    Nested
    `},function(e){return e.url},function(e){return e.empty},function(e){return e.null},function(e){return e.attr},function(e){return expression.bind(e)},function(e){return e.event},function(e){return e.onEvent.bind(e)},function(e){return e.arr},function(e,t,n){return n},function(e,t,n){return n},function(e,t,n){return n},function(e){return e.arr},function(e,t,n){return t},function(e,t,n){return n},function(e,t,n){return t+". "},function(e,t,n){return n},function(e,t,n){return n},function(e){return e.arrWithKeys},function(e,t,n){return t},function(e,t,n){return n},function(e,t,n){return t+": "},function(e,t,n){return t},function(e,t,n){return n},function(e,t,n){return n},function(e){return e.arrNested},function(e,t,n){return n},function(e,t,n,i,o){return t},function(e,t,n,i,o){return i},function(e,t,n,i,o){return o},function(e,t,n,i,o){return t+". "+i+". "+o},function(e){return e.arrNested},function(e,t,n){return t==="b"},function(e,t,n){return n},function(e,t,n,i,o){return t},function(e,t,n,i,o){return i},function(e,t,n,i,o){return o},function(e,t,n,i,o){return t+". "+i+". "+o},function(e){return e.toggleIf.bind(e)},function(e){return e.toggleElseIf.bind(e)},function(e){return e.ifValue},function(e){return e.ifElseValue},function(e){return e.ifValue},function(e){return e.ifElseValue},function(e){return e.arr},function(e,t,n){return n}];var q=class extends m{_name="TodoApp";text="";items=[];handleSubmit(t){t.preventDefault(),k(this.text)!=0&&(this.items.push(this.text),this.text="")}},ie=[function(e){return function(t){e.handleSubmit(t)}},function(e){return e.text},function(e){return`
        Add #`+(S(e.items)+1)+`
    `},function(e){return e.items}];var z=class extends m{_name="TodoList";items=null},ue=[function(e){return e.items},function(e,t,n){return n}];var I={CounterReducer:D,TodoReducer:M,MenuBar:L,Counter_x:Z,Counter:P,HomePage_x:ee,HomePage:H,Layout_x:te,Layout:K,NotFoundPage:O,CounterPage:R,TodoAppPage:F,StatefulCounter_x:ne,StatefulCounter:U,StatefulTodoApp_x:oe,StatefulTodoApp:W,TestComponent_x:re,TestComponent:j,TodoApp_x:ie,TodoApp:q,TodoList_x:ue,TodoList:z};var fe=0,E={};function $(e){return e.__aid||(e.__aid=++fe,E[e.__aid]={current:-1,target:e,invalid:[],added:0}),E[e.__aid]}function B(e,t){let n=document.createTextNode("");return n._anchor=!0,e.current++,t.childNodes.length>e.current?t.insertBefore(n,t.childNodes[e.current]):t.appendChild(n),n}function ce(e){let t=new Proxy(e,{set(n,i,o){var u=n[i]!==o,c=Reflect.set(n,i,o);if(u&&i in n.$$r)for(let r in n.$$r[i]){let p=n.$$r[i][r];p[0].apply(null,p[1])}return c}});return e.$=e,t}function se(e,t){let n=$(e),i=e.childNodes.length,o=n.current+3;o=o>i?i:o;let u=[];for(let r=n.current+1;r<o;r++){let p=e.childNodes[r];if(p.nodeType===8)return n.current=r,n.invalid=n.invalid.concat(u),p;u.push(r)}n.added++,n.invalid=n.invalid.concat(u),console.log("Hydrate comment not found",t);let c=document.createComment(t);return n.current=n.current+u.length+1,i>n.current?e.insertBefore(c,e.childNodes[n.current]):e.appendChild(c)}function le(e,t){let n=$(e),i=e.childNodes.length,o=n.current+3;o=o>i?i:o;let u=[];for(let r=n.current+1;r<o;r++){let p=e.childNodes[r];if(p.nodeType===1&&p.nodeName.toLowerCase()===t)return n.current=r,n.invalid=n.invalid.concat(u),p;u.push(r)}n.added++,n.invalid=n.invalid.concat(u),console.log("Hydrate not found",t);let c=document.createElement(t);return n.current=n.current+u.length+1,i>n.current?e.insertBefore(c,e.childNodes[n.current]):e.appendChild(c)}function w(e,t,n,i){let o=[e];i&&(o=o.concat(i.arguments));let u=t.expression?e.$$t[t.code].apply(null,o):t.content??"";n.nodeValue!==u&&(n.nodeValue=u)}function ae(e,t,n,i){let o=$(e),u=e.childNodes.length,c=o.current+3;c=c>u?u:c;let r=[],p=o.current>-1?o.current:o.current+1;for(let s=p;s<c;s++){let N=e.childNodes[s];if(N.nodeType===3){if(s===o.current)break;return o.current=s,o.invalid=o.invalid.concat(r),w(t,n,N,i),N}s!==o.current&&r.push(s)}o.added++,o.invalid=o.invalid.concat(r);let _=document.createTextNode("");return w(t,n,_,i),o.current=o.current+r.length+1,console.log("Hydrate not found",_),u>o.current?e.insertBefore(_,e.childNodes[o.current]):e.appendChild(_)}function J(e,t,n,i,o){let u=null;if(t.children){u="";for(let c=0;c<t.children.length;c++){let r=t.children[c],p=[e];o&&(p=p.concat(o.arguments));let _=r.expression?e.$$t[r.code].apply(null,p):r.content??"";u=c===0?_:u+(_??"")}}u!==null?u!==n.getAttribute(i)&&n.setAttribute(i,u):n.removeAttribute(i)}function G(e,t,n,i,o,u,c){let r=!0;for(let p=0;p<c;p++)r=r&&!o.values[p];if(n.children&&(r=r&&!!e.$$t[n.children[0].code](e)),o.values[c]!==r)if(o.values[c]=r,r)C(i,e,[t],{...u},!1,!0);else for(;!i.previousSibling._anchor;)i.previousSibling.remove()}function me(e,t,n){let i=t.expression?e.$$t[t.code](e):t.content??"";n.nodeValue!==i&&(n.nodeValue=i)}function C(e,t,n,i,o=!0,u=!1,c){let r=null,p=!1;for(let _=0;_<n.length;_++){let s=n[_],N=e,g=!1,Y=!1;switch(s.type){case"tag":{if(s.directives){let h=i||{map:{},storage:{}},x=[t];c&&(x=x.concat(c.arguments));for(let f=0;f<s.directives.length;f++){let l=s.directives[f];if(!(f in h.map)){switch(h.map[f]=!0,l.content){case"if":{r={values:[],index:0,subs:[]};let a=!!t.$$t[l.children[0].code].apply(null,x);r.values.push(a);let b=$(e);B(b,e),a&&C(e,t,[s],h,o,u,c);let T=B(b,e);if(l.children[0].subs)for(let v in l.children[0].subs){let y=l.children[0].subs[v];r.subs.push(y),t.$$r[y]||(t.$$r[y]=[]),t.$$r[y].push([G,[t,s,l,T,r,{...h},r.index]])}r.index++,g=!0;break}case"else-if":{if(r){let a=!0;for(let v=0;v<r.index;v++)a=a&&!r.values[v];a=a&&!r.values[r.index-1]&&!!t.$$t[l.children[0].code].apply(null,x),r.values.push(a);let b=$(e);B(b,e),a&&C(e,t,[s],h,o,u,c);let T=B(b,e);l.children[0].subs&&(r.subs=r.subs.concat(l.children[0].subs));for(let v in r.subs){let y=r.subs[v];t.$$r[y]||(t.$$r[y]=[]),t.$$r[y].push([G,[t,s,l,T,r,{...h},r.index]])}r.index++,g=!0}else console.warn("Directive else-if has missing previous if/else-if",l.content,l);break}case"else":{if(r){let a=!0;for(let v=0;v<r.index;v++)a=a&&!r.values[v];r.values.push(a);let b=$(e);B(b,e),a&&C(e,t,[s],h,o,u,c);let T=B(b,e);for(let v in r.subs){let y=r.subs[v];t.$$r[y]||(t.$$r[y]=[]),t.$$r[y].push([G,[t,s,l,T,r,{...h},r.index]])}r.index++,g=!0}else console.warn("Directive else has missing previous if/else-if",l.content,l);break}case"foreach":{let a=t.$$t[l.children[0].forData].apply(null,x),b=Array.isArray(a);for(let T in a){let v=b?+T:T,y=a[v],A=c?{map:{...c.map},arguments:[...c.arguments]}:{map:{},arguments:[]};A.map[l.children[0].forKey]=A.arguments.length,A.arguments.push(v),A.map[l.children[0].forItem]=A.arguments.length,A.arguments.push(y),C(e,t,[s],{map:{...h.map},storage:{...h.storage}},o,u,A)}g=!0;break}default:{console.warn("Directive not implemented",l.content,l),g=!0;break}}if(g)break}}if(g)continue}if(s.content==="template"){p=u;break}Y=!0;let d=s.expression?t.$$t[s.code](t):s.content??"";N=o?le(e,d):u?e.parentElement.insertBefore(document.createElement(d),e):e.appendChild(document.createElement(d));break}case"text":{let d;if(o?d=ae(e,t,s,c):(d=document.createTextNode(""),w(t,s,d),u?e.parentElement.insertBefore(d,e):e.appendChild(d)),s.subs)for(let h in s.subs){let x=s.subs[h];t.$$r[x]||(t.$$r[x]=[]),t.$$r[x].push([w,[t,s,d,c]])}break}case"comment":{let d=s.expression?t.$$t[s.code](t):s.content??"",h=o?se(e,d):u?e.parentElement.insertBefore(document.createComment(d),e):e.appendChild(document.createComment(d));if(s.subs)for(let x in s.subs){let f=s.subs[x];t.$$r[f]||(t.$$r[f]=[]),t.$$r[f].push([me,[t,s,h]])}break}default:{console.log("Not implemented",s);break}}if(Y){if(s.attributes){let d=o?N.getAttributeNames():null,h=o?{}:null;for(let x in s.attributes){let f=s.attributes[x],l=f.expression?t.$$t[f.code](t):f.content??"";if(l[0]==="("){let a=l.substring(1,l.length-1);if(f.children){let b=t.$$t[f.dynamic?f.dynamic.code:f.children[0].code](t);N.addEventListener(a,b),console.log("Event",f,a,b)}}else{o&&(h[l]=!0),J(t,f,N,l,c);let a=[];if(f.children)for(let b in f.children){let T=f.children[b];T.subs&&(a=a.concat(T.subs))}if(a)for(let b in a){let T=a[b];t.$$r[T]||(t.$$r[T]=[]),t.$$r[T].push([J,[t,f,N,l,c]])}}}if(o)for(let x=0;x<d.length;x++)d[x]in h||N.removeAttribute(d[x])}else if(o){let d=N.getAttributeNames();for(let h=0;h<d.length;h++)N.removeAttribute(d[h])}}s.children&&C(N,t,s.children,void 0,o,p,c)}}function V(e){let t="value";switch(e.t){case"t":{t="tag";break}case"a":{t="attr";break}case void 0:case"v":{t="value";break}case"c":{t="component";break}case"x":{t="text";break}case"m":{t="comment";break}case"r":{t="root";break}default:throw new Error("Type "+e.t+" is not defined in build")}if(e.type=t,delete e.t,e.c&&(e.content=e.c,delete e.c),e.e&&(e.expression=e.e,delete e.e),e.a){e.attributes=e.a,delete e.a;for(let n in e.attributes)V(e.attributes[n])}if(e.i){e.directives=e.i,delete e.i;for(let n in e.directives)V(e.directives[n])}if(e.h){e.children=e.h,delete e.h;for(let n in e.children)V(e.children[n])}}var X={},pe=()=>({version:"2.0.1"});globalThis.Viewi=pe;console.log("Viewi entry");var Q=document.getElementById("counter");function de(e){if(!(e in X))throw new Error(`Component ${e} not found.`);if(!(e in I))throw new Error(`Component ${e} not found.`);let t=X[e].nodes,n=ce(new I[e]),i=e+"_x";if(i in I&&(n.$$t=I[i]),Q&&t){t.unpacked||(V(t),t.unpacked=!0);let o=t.children;console.log(Q,n,o),o&&C(Q,n,o)}console.log(E);for(let o in E){let u=E[o];for(let c=u.target.childNodes.length-1;c>=u.current+1;c--)u.target.childNodes[c].remove();for(let c=u.invalid.length-1;c>=0;c--)u.target.childNodes[u.invalid[c]].remove()}}(async()=>(X=await(await fetch("/assets/components.json")).json(),setTimeout(()=>de("TestComponent"),500)))();})();
